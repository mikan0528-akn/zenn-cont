---
title: "ä»®æƒ³ãƒã‚·ãƒ³(VM)ã§botã‚’å¸¸æ™‚èµ·å‹•ã™ã‚‹"
emoji: "ğŸ“Ÿ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Discord,ä»®æƒ³ãƒã‚·ãƒ³]
published: true
---

:::message
Ubuntu22.04LTSã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
botã¯Node.jsã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
:::
ã“ã‚“ã«ã¡ã¯ã€ä¼¼é³¥ã§ã™ï¼
ä»Šå›ã¯ã€ä»®æƒ³ãƒã‚·ãƒ³ä¸Šã§botã‚’å¸¸æ™‚èµ·å‹•ã•ã›ã‚‹æ–¹æ³•ã‚’å‚™å¿˜éŒ²ã‚‚å…¼ã­ã¦æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ï¼
ãƒãƒƒãƒˆã‚’æ¢ç´¢ã™ã‚‹ã¨nohupã¨ã‹ãŒã‚ã‚Šã¾ã—ãŸãŒã€å…¨ç„¶é§„ç›®ã ã£ãŸã®ã§Systemmdã«ç™»éŒ²ã—ã¦ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–ã—ã¾ã™
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹
hoge.serviceã‚’/etc/systemd/systemã«ä½œæˆã—ã¾ã™ï¼
(ãƒ‘ã‚¹ã¯/etc/systemd/system/hoge.service)
ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„
ã€Œhogeã€ã¯ã‚µãƒ¼ãƒ“ã‚¹åã€ã€Œhogekunã€ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§ã™ã€‚
ã€ŒWorkingDirectoryã€ã¯å®Ÿè¡Œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
ã€ŒExecStartã€ã¯1ã¤ç›®ã¯Node.jsã®ãƒ‘ã‚¹ã€2ã¤ç›®ã¯botã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
```a:hoge.service
[Unit]
Description= Node.js hoge

[Service]
Type=simple
User=hogekun
WorkingDirectory=/home/hogekun/programs/botkun
ExecStart=/bin/node /home/hogekun/programs/botkun/index.js
ExecStop=/usr/bin/pkill -e node
Restart=always
RestartSec=2
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=hoge

[Install]
WantedBy=multi-user.target
```

# Systemdã¸ã®ç™»éŒ²ç­‰
1. ãƒ•ã‚¡ã‚¤ãƒ«ãŒèªè­˜ã•ã‚Œã¦ã„ã‚‹ã‹ã®ç¢ºèª
```linux
$ systemctl list-unit-files --type=service | grep hoge
```
2. èµ·å‹•ã™ã‚‹
```linux
$ systemctl start hoge.service
```
3. çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹
```linux
$ systemctl status hoge.service
```
4. è‡ªå‹•èµ·å‹•ã‚’æœ‰åŠ¹ã«ã™ã‚‹
```linux
$ systemctl enable hoge.service
```

# ãŠã‚ã‚Šã«
ä»¥ä¸ŠãŒä»®æƒ³ãƒã‚·ãƒ³ã§botã‚’è‡ªå‹•èµ·å‹•ã™ã‚‹æ–¹æ³•ã§ã™ï¼
ä»®æƒ³ãƒã‚·ãƒ³ã˜ã‚ƒãªãã¦ã‚‚ã ã„ãŸã„å‹•ãã¨æ€ã„ã¾ã™ã®ã§ãœã²ã‚„ã£ã¦ã¿ã¦ãã ã•ã„ï¼